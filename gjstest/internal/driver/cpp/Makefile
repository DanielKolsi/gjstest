PROJECT_ROOT = ../../../..
GMOCK_PATH = $(PROJECT_ROOT)/third_party/gmock
default: driver_main.a

# Tools and flags.
include $(PROJECT_ROOT)/tools.mk

######################################################
# Libraries
######################################################

# Objects to include in the library.
LIB_OBJS = driver.o test_case.o v8_utils.o
MAIN_OBJS = $(LIB_OBJS) driver_main.a

driver_main.a : $(MAIN_OBJS)
	rm -f $@
	$(AR) $(ARFLAGS) $@ $^

######################################################
# Tests
######################################################

# Additional objects to include in the test.
TEST_OBJS = v8_utils_test.o
TEST_DEPS = \
    $(GMOCK_PATH)/gmock_main.a \
    $(PROJECT_ROOT)/third_party/cityhash/cityhash.a \
    $(PROJECT_ROOT)/base/base.a \
    $(PROJECT_ROOT)/strings/strings.a \
    $(PROJECT_ROOT)/webutil/xml/xml.a \

v8_utils_test.bin : $(LIB_OBJS) $(TEST_OBJS) $(TEST_DEPS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $^ -o $@ -lglog -lxml2 -lre2 -lprotobuf -lv8 -gflags

test : v8_utils_test.bin
	./v8_utils_test.bin

######################################################
# House-keeping
######################################################

# depend target
OBJS = $(MAIN_OBJS) $(TEST_OBJS)
include $(PROJECT_ROOT)/depend_target.mk

clean :
	rm -f *.o
	rm -f *.a

## Dependencies: (autogenerated) ##
driver.o: driver.cc ../../../../gjstest/internal/driver/cpp/driver.h \
  ../../../../base/stl_decl.h ../../../../base/stl_decl_osx.h \
  ../../../../base/basictypes.h ../../../../base/integral_types.h \
  ../../../../base/integral_types.h ../../../../base/logging.h \
  ../../../../base/macros.h ../../../../base/type_traits.h \
  ../../../../base/template_util.h ../../../../base/stl_decl.h \
  ../../../../base/stringprintf.h ../../../../base/timer.h \
  ../../../../base/macros.h \
  ../../../../gjstest/internal/compiler/compiler.pb.h \
  ../../../../gjstest/internal/driver/cpp/test_case.h \
  ../../../../base/integral_types.h ../../../../base/macros.h \
  ../../../../gjstest/internal/driver/cpp/v8_utils.h \
  ../../../../base/callback-types.h ../../../../base/callback.h \
  ../../../../base/logging.h ../../../../strings/strutil.h \
  ../../../../base/basictypes.h ../../../../util/gtl/map-util.h \
  ../../../../util/hash/hash.h ../../../../base/stl_decl.h \
  ../../../../third_party/cityhash/city.h \
  ../../../../webutil/xml/xml_writer.h ../../../../base/basictypes.h \
  ../../../../base/macros.h
test_case.o: test_case.cc \
  ../../../../gjstest/internal/driver/cpp/test_case.h \
  ../../../../base/integral_types.h ../../../../base/macros.h \
  ../../../../base/type_traits.h ../../../../base/template_util.h \
  ../../../../base/stl_decl.h ../../../../base/stl_decl_osx.h \
  ../../../../base/callback.h ../../../../base/logging.h \
  ../../../../base/logging.h ../../../../base/stringprintf.h \
  ../../../../base/timer.h ../../../../base/integral_types.h \
  ../../../../base/macros.h \
  ../../../../gjstest/internal/driver/cpp/v8_utils.h \
  ../../../../base/callback-types.h ../../../../base/callback.h
v8_utils.o: v8_utils.cc \
  ../../../../gjstest/internal/driver/cpp/v8_utils.h \
  ../../../../base/callback-types.h ../../../../base/callback.h \
  ../../../../base/logging.h ../../../../base/integral_types.h \
  ../../../../base/logging.h ../../../../base/stringprintf.h
driver_main.o: driver_main.cc ../../../../base/integral_types.h \
  ../../../../base/logging.h ../../../../file/file_utils.h \
  ../../../../base/basictypes.h ../../../../base/integral_types.h \
  ../../../../gjstest/internal/compiler/compiler.pb.h \
  ../../../../gjstest/internal/driver/cpp/driver.h \
  ../../../../base/stl_decl.h ../../../../base/stl_decl_osx.h \
  ../../../../strings/strutil.h ../../../../base/basictypes.h
