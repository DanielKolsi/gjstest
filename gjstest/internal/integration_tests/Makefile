PROJECT_ROOT = ../../..
default: test

# Tools and flags.
include $(PROJECT_ROOT)/tools.mk

# Extra flags to give to the integration test, for example --dump_new.
INT_TEST_ARGS =

######################################################
# Libraries
######################################################

# Objects to include in the library.
LIB_OBJS =

######################################################
# Tests
######################################################

# Additional objects to include in the test.
TEST_OBJS = integration_test.o
TEST_DEPS = \
    $(PROJECT_ROOT)/base/base.a \
    $(PROJECT_ROOT)/file/file.a \
    $(PROJECT_ROOT)/strings/strings.a \

integration_test.bin : $(LIB_OBJS) $(TEST_OBJS) $(TEST_DEPS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $^ -o $@ -lglog -lxml2 -lre2 -lprotobuf -lv8 -lgflags -lgtest -lgmock -lgmock_main

test : integration_test.bin
	./integration_test.bin --test_srcdir=. --gjstest_data_dir=$(PROJECT_ROOT)/share/gjstest --gjstest_binary=$(PROJECT_ROOT)/bin/gjstest $(INT_TEST_ARGS)

######################################################
# House-keeping
######################################################

# depend target
OBJS = $(MAIN_OBJS) $(TEST_OBJS)
include $(PROJECT_ROOT)/depend_target.mk

clean :
	rm -f *.o
	rm -f *.a

## Dependencies: (autogenerated) ##
integration_test.o: integration_test.cc ../../../base/logging.h \
  ../../../base/macros.h ../../../base/type_traits.h \
  ../../../base/template_util.h ../../../base/stringprintf.h \
  ../../../file/file_utils.h ../../../base/basictypes.h \
  ../../../base/integral_types.h ../../../strings/strutil.h \
  ../../../base/basictypes.h
